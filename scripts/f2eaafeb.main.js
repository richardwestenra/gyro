$(function(){"use strict";function a(){b()}function b(){THREEx.Planets.baseURL="",d=new THREE.WebGLRenderer({antialias:!0}),d.setSize(k,l),document.body.appendChild(d.domElement),d.shadowMapEnabled=!0,e=[],f=new THREE.Scene,g=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.01,100),g.position.z=2;var a=new THREE.AmbientLight(1118481);f.add(a),a=new THREE.DirectionalLight(8947848,1),a.position.set(5,0,5),f.add(a),a.castShadow=!0,a.shadowCameraNear=.01,a.shadowCameraFar=15,a.shadowCameraFov=45,a.shadowCameraLeft=-1,a.shadowCameraRight=1,a.shadowCameraTop=1,a.shadowCameraBottom=-1,a.shadowBias=.001,a.shadowDarkness=.6,a.shadowMapWidth=1024,a.shadowMapHeight=1024,i=THREEx.createAtmosphereMaterial(),i.side=THREE.BackSide,i.uniforms.glowColor.value.set(16777210),i.uniforms.coeficient.value=.1,j=new THREE.Mesh(new THREE.SphereGeometry(.5,32,32),i),j.position.set(30,0,30),j.scale.multiplyScalar(3),f.add(j);var b=THREEx.Planets.createStarfield();b.scale.multiplyScalar(.5),f.add(b);var c=new THREE.Object3D;c.scale.multiplyScalar(1/90),f.add(c);var m=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,color:15658734}),n=1;[-n,n].forEach(function(a){var b=new THREE.Mesh(new THREE.PlaneGeometry(2*n,n),m);b.overdraw=!0,b.position.set(1.5*a,0,0),b.castShadow=!0,c.add(b)}),n=.5;var o=new THREE.Mesh(new THREE.BoxGeometry(n,n,n),m);o.overdraw=!0,o.position.set(0,0,0),o.castShadow=!0,c.add(o);var p={angle:0,altitude:.55,speed:.75};e.push(function(a){p.angle-=p.speed*a,c.position.x=p.altitude*Math.cos(p.angle),c.position.y=p.altitude*Math.sin(p.angle),c.position.z=p.altitude*Math.sin(p.angle),c.rotation.x+=p.speed*a,c.rotation.z-=p.speed*a,c.rotation.y+=p.speed*a});var q=new THREE.Object3D;q.rotateZ(-23.4*Math.PI/180),q.position.z=0,f.add(q);var r={x:0,y:0,z:0,angle:0,altitude:3},s=THREEx.Planets.createMoon();s.position.set(r.x,r.y,r.z),s.scale.multiplyScalar(.2),s.receiveShadow=!0,s.castShadow=!0,f.add(s),e.push(function(a){var b=.2;r.angle-=b*a,r.x=r.altitude*Math.cos(r.angle),r.z=r.altitude*Math.sin(r.angle),s.position.set(r.x,r.y,r.z),s.rotation.y+=b*a});var t=THREEx.Planets.createEarth();t.receiveShadow=!0,t.castShadow=!0,q.add(t),e.push(function(a){t.rotation.y+=1/32*a}),h=new THREE.SphereGeometry(.5,32,32),i=THREEx.createAtmosphereMaterial(),i.uniforms.glowColor.value.set(3382473),i.uniforms.coeficient.value=.8,i.uniforms.power.value=2,j=new THREE.Mesh(h,i),j.scale.multiplyScalar(1.01),q.add(j),h=new THREE.SphereGeometry(.5,32,32),i=THREEx.createAtmosphereMaterial(),i.side=THREE.BackSide,i.uniforms.glowColor.value.set(3382473),i.uniforms.coeficient.value=.5,i.uniforms.power.value=22,j=new THREE.Mesh(h,i),j.scale.multiplyScalar(1.15),q.add(j);var u=THREEx.Planets.createEarthCloud();u.receiveShadow=!0,q.add(u),e.push(function(a){u.rotation.y+=.05*a});var v={x:0,y:0};document.addEventListener("mousemove",function(a){v.x=a.clientX/window.innerWidth-.5,v.y=a.clientY/window.innerHeight-.5},!1),sense.init().orientation(function(a){v.x=a.gamma/90,v.y=(a.beta-90)/180}),g.altitude=6,g.spin=10,e.push(function(a){var b=g;b.position.y+=3*(5*v.y-b.position.y)*a,b.position.x=b.altitude*Math.cos(v.x*b.spin),b.position.z=b.altitude*Math.sin(v.x*b.spin),b.lookAt(f.position)}),e.push(function(){d.render(f,g)});var w=null;requestAnimationFrame(function x(a){requestAnimationFrame(x),w=w||a-1e3/60;var b=Math.min(200,a-w);w=a,e.forEach(function(c){c(b/1e3,a/1e3)})}),window.flappy={onRenderFcts:e,scene:f,camera:g}}function c(a){a.preventDefault(),a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);var c=.2;b>0?g.altitude+=c:g.altitude-=c,g.altitude=Math.max(g.altitude,1.2),g.altitude=Math.min(g.altitude,30)}var d,e,f,g,h,i,j,k=window.innerWidth,l=window.innerHeight;document.addEventListener("mousewheel",c,!1),document.addEventListener("DOMMouseScroll",c,!1),a()});var doOnce=!0,yellow=16776960,red=16711680;$(document).ready(function(){"use strict";function a(a){a.el.position.set(a.x,a.y,-a.z),a.el.rotation.y=a.a}function b(){var a={x:k,y:0,z:0,u:0,v:0,a:-Math.PI/2,t:0,boost:0,dead:!1,el:null};a.xPrev=a.x,a.zPrev=a.z,a.aPrev=a.a;var b=.1;return a.el=new THREE.Mesh(new THREE.BoxGeometry(3*b,b,b),new THREE.MeshLambertMaterial({side:THREE.DoubleSide,color:yellow})),a.el.overdraw=!0,a.el.position.set(a.x,a.y,a.z),r.add(a.el),n.push(a),a}function c(a){a.dead=!0,a.u/=10,a.v/=10,a===s&&(s=b())}function d(a,b){return Math.sqrt(a*a+b*b)}function e(a,b){a.xPrev=a.x,a.zPrev=a.z,a.aPrev=a.a;var c=d(a.x,a.z),e=j*i/(c*c);a.f=e;var f=a.x/c,g=a.z/c;if(a.u-=f*e*b,a.v-=g*e*b,a.dead===!0)a.a+=10*b;else{var h=Math.atan2(a.z,a.x);a.a=2*k>c?h+Math.PI/2*((c-k)/k):h+Math.PI/2}var l=a.x+a.u*b,n=a.z+a.v*b,o=d(l,n);o>k?(a.x=l,a.z=n,a.t+=b):(a.x=k*l/o,a.z=k*n/o,a.u=0,a.v=0,a!==s&&-1===m.indexOf(a)&&m.push(a))}function f(f,g){s.boost===!0&&(s.u+=Math.cos(s.a)*s.f*l,s.v+=Math.sin(s.a)*s.f*l,s.t=0,s.boost=!1),g=1e3*g;for(var h=.02;f>0;)f-=h,o=0,n.forEach(function(a){e(a,h),n.forEach(function(b){if(a!==b&&a.dead!==!0&&b.dead!==!0){var e=d(a.x-b.x,a.z-b.z);.2>e&&(c(a),c(b))}}),a.dead!==!0&&a!==s&&o++}),m.forEach(function(a){-1!==n.indexOf(a)&&(r.remove(a.el),n.splice(n.indexOf(a),1))});s.t>2&&(s=b()),n.forEach(function(b){a(b,g/1e3,f/h+1)})}function g(){doOnce=!0,s.boost!==!0&&(t++,t>=5&&(t=0),s.boost=!0,s.el.material.color.setHex(red))}function h(){s.el.material.color.setHex(yellow)}var i=4,j=10,k=.6,l=.08,m=[],n=[],o=0,p=$("<span>").css({position:"fixed",top:"20px",right:"20px",color:"white","font-size":"25px"}).appendTo("body");p.text("");var q=flappy.onRenderFcts,r=flappy.scene,s=(flappy.camera,b()),t=0;$(document).on("keydown",g).on("mousedown",g).on("keyup",h).on("mouseup",h),q.push(function(a,b){f(a,b)})});