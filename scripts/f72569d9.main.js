THREE.OrbitControls=function(a,b){function c(){return 2*Math.PI/60/60*o.autoRotateSpeed}function d(){return Math.pow(.95,o.zoomSpeed)}function e(a){if(o.enabled!==!1){if(a.preventDefault(),a.button===o.mouseButtons.ORBIT){if(o.noRotate===!0)return;I=H.ROTATE,q.set(a.clientX,a.clientY)}else if(a.button===o.mouseButtons.ZOOM){if(o.noZoom===!0)return;I=H.DOLLY,y.set(a.clientX,a.clientY)}else if(a.button===o.mouseButtons.PAN){if(o.noPan===!0)return;I=H.PAN,t.set(a.clientX,a.clientY)}I!==H.NONE&&(document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1),o.dispatchEvent(M))}}function f(a){if(o.enabled!==!1){a.preventDefault();var b=o.domElement===document?o.domElement.body:o.domElement;if(I===H.ROTATE){if(o.noRotate===!0)return;r.set(a.clientX,a.clientY),s.subVectors(r,q),o.rotateLeft(2*Math.PI*s.x/b.clientWidth*o.rotateSpeed),o.rotateUp(2*Math.PI*s.y/b.clientHeight*o.rotateSpeed),q.copy(r)}else if(I===H.DOLLY){if(o.noZoom===!0)return;z.set(a.clientX,a.clientY),A.subVectors(z,y),A.y>0?o.dollyIn():o.dollyOut(),y.copy(z)}else if(I===H.PAN){if(o.noPan===!0)return;u.set(a.clientX,a.clientY),v.subVectors(u,t),o.pan(v.x,v.y),t.copy(u)}I!==H.NONE&&o.update()}}function g(){o.enabled!==!1&&(document.removeEventListener("mousemove",f,!1),document.removeEventListener("mouseup",g,!1),o.dispatchEvent(N),I=H.NONE)}function h(a){if(o.enabled!==!1&&o.noZoom!==!0&&I===H.NONE){a.preventDefault(),a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail),b>0?o.dollyOut():o.dollyIn(),o.update(),o.dispatchEvent(M),o.dispatchEvent(N)}}function i(a){if(o.enabled!==!1&&o.noKeys!==!0&&o.noPan!==!0)switch(a.keyCode){case o.keys.UP:o.pan(0,o.keyPanSpeed),o.update();break;case o.keys.BOTTOM:o.pan(0,-o.keyPanSpeed),o.update();break;case o.keys.LEFT:o.pan(o.keyPanSpeed,0),o.update();break;case o.keys.RIGHT:o.pan(-o.keyPanSpeed,0),o.update()}}function j(a){if(o.enabled!==!1){switch(a.touches.length){case 1:if(o.noRotate===!0)return;I=H.TOUCH_ROTATE,q.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(o.noZoom===!0)return;I=H.TOUCH_DOLLY;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);y.set(0,d);break;case 3:if(o.noPan===!0)return;I=H.TOUCH_PAN,t.set(a.touches[0].pageX,a.touches[0].pageY);break;default:I=H.NONE}I!==H.NONE&&o.dispatchEvent(M)}}function k(a){if(o.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=o.domElement===document?o.domElement.body:o.domElement;switch(a.touches.length){case 1:if(o.noRotate===!0)return;if(I!==H.TOUCH_ROTATE)return;r.set(a.touches[0].pageX,a.touches[0].pageY),s.subVectors(r,q),o.rotateLeft(2*Math.PI*s.x/b.clientWidth*o.rotateSpeed),o.rotateUp(2*Math.PI*s.y/b.clientHeight*o.rotateSpeed),q.copy(r),o.update();break;case 2:if(o.noZoom===!0)return;if(I!==H.TOUCH_DOLLY)return;var c=a.touches[0].pageX-a.touches[1].pageX,d=a.touches[0].pageY-a.touches[1].pageY,e=Math.sqrt(c*c+d*d);z.set(0,e),A.subVectors(z,y),A.y>0?o.dollyOut():o.dollyIn(),y.copy(z),o.update();break;case 3:if(o.noPan===!0)return;if(I!==H.TOUCH_PAN)return;u.set(a.touches[0].pageX,a.touches[0].pageY),v.subVectors(u,t),o.pan(v.x,v.y),t.copy(u),o.update();break;default:I=H.NONE}}}function l(){o.enabled!==!1&&(o.dispatchEvent(N),I=H.NONE)}this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var m,n,o=this,p=1e-6,q=new THREE.Vector2,r=new THREE.Vector2,s=new THREE.Vector2,t=new THREE.Vector2,u=new THREE.Vector2,v=new THREE.Vector2,w=new THREE.Vector3,x=new THREE.Vector3,y=new THREE.Vector2,z=new THREE.Vector2,A=new THREE.Vector2,B=0,C=0,D=1,E=new THREE.Vector3,F=new THREE.Vector3,G=new THREE.Quaternion,H={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},I=H.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone();var J=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),K=J.clone().inverse(),L={type:"change"},M={type:"start"},N={type:"end"};this.rotateLeft=function(a){void 0===a&&(a=c()),C-=a},this.rotateUp=function(a){void 0===a&&(a=c()),B-=a},this.panLeft=function(a){var b=this.object.matrix.elements;w.set(b[0],b[1],b[2]),w.multiplyScalar(-a),E.add(w)},this.panUp=function(a){var b=this.object.matrix.elements;w.set(b[4],b[5],b[6]),w.multiplyScalar(a),E.add(w)},this.pan=function(a,b){var c=o.domElement===document?o.domElement.body:o.domElement;if(void 0!==o.object.fov){var d=o.object.position,e=d.clone().sub(o.target),f=e.length();f*=Math.tan(o.object.fov/2*Math.PI/180),o.panLeft(2*a*f/c.clientHeight),o.panUp(2*b*f/c.clientHeight)}else void 0!==o.object.top?(o.panLeft(a*(o.object.right-o.object.left)/c.clientWidth),o.panUp(b*(o.object.top-o.object.bottom)/c.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(a){void 0===a&&(a=d()),D/=a},this.dollyOut=function(a){void 0===a&&(a=d()),D*=a},this.update=function(){var a=this.object.position;x.copy(a).sub(this.target),x.applyQuaternion(J),m=Math.atan2(x.x,x.z),n=Math.atan2(Math.sqrt(x.x*x.x+x.z*x.z),x.y),this.autoRotate&&I===H.NONE&&this.rotateLeft(c()),m+=C,n+=B,m=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,m)),n=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,n)),n=Math.max(p,Math.min(Math.PI-p,n));var b=x.length()*D;b=Math.max(this.minDistance,Math.min(this.maxDistance,b)),this.target.add(E),x.x=b*Math.sin(n)*Math.sin(m),x.y=b*Math.cos(n),x.z=b*Math.sin(n)*Math.cos(m),x.applyQuaternion(K),a.copy(this.target).add(x),this.object.lookAt(this.target),C=0,B=0,D=1,E.set(0,0,0),(F.distanceToSquared(this.object.position)>p||8*(1-G.dot(this.object.quaternion))>p)&&(this.dispatchEvent(L),F.copy(this.object.position),G.copy(this.object.quaternion))},this.reset=function(){I=H.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.update()},this.getPolarAngle=function(){return n},this.getAzimuthalAngle=function(){return m},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",e,!1),this.domElement.addEventListener("mousewheel",h,!1),this.domElement.addEventListener("DOMMouseScroll",h,!1),this.domElement.addEventListener("touchstart",j,!1),this.domElement.addEventListener("touchend",l,!1),this.domElement.addEventListener("touchmove",k,!1),window.addEventListener("keydown",i,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,$(function(){"use strict";function a(){b()}function b(){THREEx.Planets.baseURL="";var a,b,c,d=new THREE.WebGLRenderer({antialias:!0});d.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(d.domElement),d.shadowMapEnabled=!0;var e=[],f=new THREE.Scene,g=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.01,100);g.position.z=2;var h=new THREE.AmbientLight(1118481);f.add(h),h=new THREE.DirectionalLight(8947848,1),h.position.set(5,.5,5),f.add(h),h.castShadow=!0,h.shadowCameraNear=.01,h.shadowCameraFar=15,h.shadowCameraFov=45,h.shadowCameraLeft=-1,h.shadowCameraRight=1,h.shadowCameraTop=1,h.shadowCameraBottom=-1,h.shadowBias=.001,h.shadowDarkness=.6,h.shadowMapWidth=1024,h.shadowMapHeight=1024,b=THREEx.createAtmosphereMaterial(),b.side=THREE.BackSide,b.uniforms.glowColor.value.set(16777210),b.uniforms.coeficient.value=.1,c=new THREE.Mesh(new THREE.SphereGeometry(.5,32,32),b),c.position.set(50,1,50),c.scale.multiplyScalar(3),f.add(c);var i=THREEx.Planets.createStarfield();f.add(i);var j={x:-1,y:0,z:0,angle:0,altitude:.55,speed:.75},k=new THREE.Object3D;k.position.set(j.x,j.y,j.z),k.scale.multiplyScalar(1/90),f.add(k);var l=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,color:15658734}),m=1;[-m,m].forEach(function(a){var b=new THREE.Mesh(new THREE.PlaneGeometry(2*m,m),l);b.overdraw=!0,b.position.set(1.5*a,0,0),b.castShadow=!0,k.add(b)}),m=.5;var n=new THREE.Mesh(new THREE.BoxGeometry(m,m,m),l);n.overdraw=!0,n.position.set(0,0,0),n.castShadow=!0,k.add(n),e.push(function(a){j.angle-=j.speed*a,j.x=j.altitude*Math.cos(j.angle),j.y=j.altitude*Math.sin(j.angle),j.z=j.altitude*Math.sin(j.angle),k.position.set(j.x,j.y,j.z),k.rotation.x+=j.speed*a,k.rotation.z-=j.speed*a,k.rotation.y+=j.speed*a});var o=new THREE.Object3D;o.rotateZ(-23.4*Math.PI/180),o.position.z=0,f.add(o);var p={x:0,y:0,z:0,angle:0,altitude:1},q=THREEx.Planets.createMoon();q.position.set(p.x,p.y,p.z),q.scale.multiplyScalar(.2),q.receiveShadow=!0,q.castShadow=!0,o.add(q),e.push(function(a){var b=.2;p.angle-=b*a,p.x=p.altitude*Math.cos(p.angle),p.z=p.altitude*Math.sin(p.angle)-.03,q.position.set(p.x,p.y,p.z),q.rotation.y+=b*a});var r=THREEx.Planets.createEarth();r.receiveShadow=!0,r.castShadow=!0,o.add(r),e.push(function(a){r.rotation.y+=1/32*a}),a=new THREE.SphereGeometry(.5,32,32),b=THREEx.createAtmosphereMaterial(),b.uniforms.glowColor.value.set(46079),b.uniforms.coeficient.value=.8,b.uniforms.power.value=2,c=new THREE.Mesh(a,b),c.scale.multiplyScalar(1.01),o.add(c),a=new THREE.SphereGeometry(.5,32,32),b=THREEx.createAtmosphereMaterial(),b.side=THREE.BackSide,b.uniforms.glowColor.value.set(46079),b.uniforms.coeficient.value=.5,b.uniforms.power.value=22,c=new THREE.Mesh(a,b),c.scale.multiplyScalar(1.15),o.add(c);var s=THREEx.Planets.createEarthCloud();s.receiveShadow=!0,o.add(s),e.push(function(a){s.rotation.y+=.05*a});var t={x:0,y:0};document.addEventListener("mousemove",function(a){t.x=a.clientX/window.innerWidth-.5,t.y=a.clientY/window.innerHeight-.5},!1),sense.init().orientation(function(a){t.x=a.gamma/90,t.y=(a.beta-90)/180});var u={alt:2,spin:4};e.push(function(a){g.position.y+=3*(5*t.y-g.position.y)*a,g.position.x=u.alt*Math.cos(t.x*u.spin),g.position.z=u.alt*Math.sin(t.x*u.spin),g.lookAt(f.position)}),e.push(function(){d.render(f,g)});var v=null;requestAnimationFrame(function w(a){requestAnimationFrame(w),v=v||a-1e3/60;var b=Math.min(200,a-v);v=a,e.forEach(function(c){c(b/1e3,a/1e3)})})}a()});